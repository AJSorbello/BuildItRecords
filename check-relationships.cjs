const { getPool } = require("./api/db-utils"); async function main() { const pool = getPool(); const client = await pool.connect(); try { console.log("Checking artist-release relationships"); const junctionTable = await client.query("SELECT COUNT(*) FROM release_artists"); console.log(`Total release-artist relationships: ${junctionTable.rows[0].count}`); console.log("Checking releases with buildit-records label:"); const labelReleases = await client.query("SELECT COUNT(*) FROM releases WHERE label_id = $1", ["buildit-records"]); console.log(`Releases with label_id="buildit-records": ${labelReleases.rows[0].count}`); console.log("Checking unique artists for this label:"); const artistsQuery = `SELECT COUNT(DISTINCT a.id) FROM artists a JOIN release_artists ra ON a.id = ra.artist_id JOIN releases r ON ra.release_id = r.id WHERE r.label_id = $1`; const labelArtists = await client.query(artistsQuery, ["buildit-records"]); console.log(`Unique artists for buildit-records across all releases: ${labelArtists.rows[0].count}`); } finally { client.release(); } } main().catch(console.error);
